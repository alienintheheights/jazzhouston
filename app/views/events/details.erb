<%= render :partial => "common/extjs", :locals=>{:jsonly=>false} %>
<script src="/common/js/Ext.ux.GMapPanel.js"></script>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=<%=google_map_key%>"
        type="text/javascript"></script>

<script type="text/javascript">

    Ext.onReady(function(){

        var mapwin;
        var button = Ext.get('show-btn');

        button.on('click', function(){
            // create the window on the first click and reuse on subsequent clicks
            if(!mapwin){
            <% if @venue %>
                mapwin = new Ext.Window({
                    layout: 'fit',
                    title: "<%=@venue.title%>",
                    closeAction: 'hide',
                    width:300,
                    height:300,
                    items: {
                        xtype: 'gmappanel',
                        region: 'center',
                        zoomLevel: 14,
                        gmapType: 'map',
                        mapConfOpts: ['enableScrollWheelZoom','enableDoubleClickZoom','enableDragging'],
                        mapControls: ['GSmallMapControl','GMapTypeControl','NonExistantControl'],
                        setCenter: {
                            geoCodeAddr: '<%=@venue.address%>,  USA',
                            marker: {title: "<%=@venue.title%>"}
                        },
                        markers: [{
                            lat: 42.339641,
                            lng: -71.094224,
                            marker: {title: 'venue'},
                            listeners: {
                                click: function(e){
                                    Ext.Msg.alert('JazzHouston.com Google Map window', 'and its art.');
                                }
                            }
                        },{
                            lat: 42.339419,
                            lng: -71.09077,
                            marker: {title: "<%=@venue.title%>"}
                        }]
                    }
                });
            <% end %>

            }

            mapwin.show();

        });

    });

</script>


<div id="StageMedium">
  <ul class="breadcrumbs">
    <li>
      <a href="/events">Events</a>
    </li>
    <li>
      Show Listing
    </li>
  </ul>


  <div class="HeaderShow"><%=@show.performer%></div>

  <div class="inside">

    <div class="hspacer"></div>
    <table class="index-two-column-small">
      <tr>
        <td valign="top" colspan="2">

          <%if logged_in? && current_user.editor_flag==1 -%>
              <div style="float:right;">
                <a href="/events/edit/<%=@show.event_id%>"><img src="/images/icons/reply.png" border="0" alt="edit">Edit</a><br/>
              </div>
          <% end -%>
          <b><%= @show.performer %></b>
          <br/>
          <% if @show.show_date %>
              <%=  @show.show_date.strftime("%A, %B #{@show.show_date.day.ordinalize}") %> <br/>
          <% end %>
          <% if @show.day_of_week && !@show.show_date %>
              <b><%= dow[@show.day_of_week] %>s</b> <br/>
          <% end %>
          <% if @show.venue  %>
              <a href="/venues/about/<%= @show.venue_id %>"><%= @show.venue.title %></a>, <%=@show.show_time%><br/>
          <% end %>

          <div class="hspacer"></div>
          <%= @show.about.html_safe %>
          <div class="hspacer"></div>
          <% if @show.related_url && @show.related_url!=""%>
              <a href="<%=@show.related_url%>"><%=@show.related_url%></a>
          <% end %>
          <br/>
          <% if @player%>
              Musician Profile: <a href="/members/profile/<%= @player.user_id %>"><%=@player.first_name%> <%=@player.last_name%></a>   <br/>
          <% end %>
          <br/>
          <%= render :partial => "common/socialrow", :locals => {
                  :title=>@show.performer,
                  :url=>request.url}%>
        </td>
      </tr></table>
    <div class="hspacer"></div>
  </div>


  <div class="HeaderShow">
    <%= @venue.title %>
  </div>
  <div class="cd-inside">

    <div class="hspacer"></div>
    <% if @venue %>

        <table class="index-two-column-small">
          <tr>
            <td valign="top" colspan="2">
              <% if @venue.image_url && @venue.image_url!="" %>
                  <img src="<%=@venue.image_url%>" align="left" hspace="2" width="150">
              <% elsif @venue.photo.exists? then %>
                  <%= image_tag @venue.photo.url(:small), :align=>"left", :width=>"150", :hspace=>"3" %>
              <% end %>
              <%= @venue.about.html_safe %>

              <div class="hspacer"></div>

              <b>Address:</b> <%=@venue.address%>
              <input type="button" id="show-btn" value="Google Map" />
              <br/><b>Phone:</b> <%=@venue.phone%>
              <% if @venue.related_url %>
                  <br/><b>Web Site:</b> <a href="<%=@venue.related_url%>"><%=@venue.related_url%></a>
              <% end %>
              <br/>
              <a href="/venues/about/<%= @show.venue_id %>#shows"><b>More</b></a> upcoming shows at <%=@venue.title%>

            </td></tr></table>
    <% end %>


    <div class="hspacer"></div>


  </div>
</div>

